name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version: "1.24"
      - run: sudo apt-get update && sudo apt-get install -y libasound2-dev
      - run: go vet ./...
      - run: go test ./...

  build-check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - goos: windows
            goarch: amd64
          - goos: darwin
            goarch: arm64
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version: "1.24"
      - name: Check CLI build
        env:
          GOOS: ${{ matrix.goos }}
          GOARCH: ${{ matrix.goarch }}
          CGO_ENABLED: "0"
        run: go build ./cmd/notify
      - name: Check app build (Windows)
        if: matrix.goos == 'windows'
        env:
          GOOS: windows
          GOARCH: amd64
          CGO_ENABLED: "0"
        run: go build -tags desktop,production -ldflags "-w -s -H windowsgui" -o /dev/null ./cmd/notify-app
